{% extends "admin/change_list.html" %}

{% block content %}
<div class="module" style="margin-bottom: 20px;">
  <h2>Herramientas UTI</h2>
  <div style="display: grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap: 12px;">
    <form method="post" action="{% url 'admin:alumnos_alumno_ingesta' %}" class="aligned">
      {% csrf_token %}
      <input type="hidden" name="action" value="seed_pre">
      <h3>Seed Preinscriptos</h3>
      <label>Cantidad (n): <input type="number" name="n" min="0" max="50" value="5"></label>
      <label>Seed (opcional): <input type="number" name="seed" min="0"></label>
      <p><button type="submit" class="button default">Ejecutar</button></p>
    </form>

    <form method="post" action="{% url 'admin:alumnos_alumno_ingesta' %}" class="aligned">
      {% csrf_token %}
      <input type="hidden" name="action" value="seed_asp">
      <h3>Seed Aspirantes</h3>
      <label>Cantidad (n): <input type="number" name="n" min="0" max="50" value="5"></label>
      <label>Seed (opcional): <input type="number" name="seed" min="0"></label>
      <p><button type="submit" class="button default">Ejecutar</button></p>
    </form>

    <form method="post" action="{% url 'admin:alumnos_alumno_ingesta' %}" class="aligned">
      {% csrf_token %}
      <input type="hidden" name="action" value="consume">
      <h3>Consumir</h3>
      <label>Tipo:
        <select name="tipo">
          <option value="preinscriptos">preinscriptos</option>
          <option value="aspirantes">aspirantes</option>
          <option value="ingresantes">ingresantes</option>
        </select>
      </label>
      <label>Cantidad (n, opcional): <input type="number" name="n" min="0" max="50"></label>
      <label>Seed (opcional): <input type="number" name="seed" min="0"></label>
      <label>Desde (AAAAMMDDHHMM, opcional):
        <input id="uti-desde" type="text" name="desde" placeholder="202501010000">
      </label>
      <label>Hasta (AAAAMMDDHHMM, opcional):
        <input id="uti-hasta" type="text" name="hasta" placeholder="202501312359">
      </label>
      <div style="display:flex; gap:8px; flex-wrap: wrap;">
        <button type="button" class="button" onclick="window.setUtiRangoAhora()">Ahora</button>
        <button type="button" class="button" onclick="window.setUtiRangoHoy()">Hoy</button>
      </div>
      <label style="display: flex; align-items: center; gap: 8px; margin-top: 10px;">
        <input type="checkbox" name="enviar_email" value="1">
        ðŸ“§ Enviar emails de bienvenida a nuevos alumnos
      </label>
      <p><button type="submit" class="button default">Consumir</button></p>
    </form>

    <form method="post" action="{% url 'admin:alumnos_alumno_ingesta' %}" class="aligned">
      {% csrf_token %}
      <input type="hidden" name="action" value="truncate">
      <h3>Borrar todos</h3>
      <p>Elimina todos los alumnos.</p>
      <p><button type="submit" class="button delete">Borrar</button></p>
    </form>
  </div>
</div>

<script>
  (function() {
    function fmt(dt) {
      const pad = (n, w = 2) => String(n).padStart(w, "0");
      return (
        dt.getFullYear().toString() +
        pad(dt.getMonth() + 1) +
        pad(dt.getDate()) +
        pad(dt.getHours()) +
        pad(dt.getMinutes())
      );
    }
    window.setUtiRangoAhora = function() {
      const now = new Date();
      document.getElementById("uti-desde").value = fmt(now);
      document.getElementById("uti-hasta").value = fmt(now);
    };
    window.setUtiRangoHoy = function() {
      const now = new Date();
      const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0);
      const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59);
      document.getElementById("uti-desde").value = fmt(start);
      document.getElementById("uti-hasta").value = fmt(end);
    };
  })();
</script>

{{ block.super }}
{% endblock %}
